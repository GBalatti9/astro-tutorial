---
import BlogPost from "@components/BlogPost.astro";
import type { GetStaticPaths } from "astro";
import Layout from "src/layouts/Layout.astro";

export const getStaticPaths = (async () => {

    const allPosts = await Astro.glob("../posts/*.md");
    const uniqueTags = [...new Set(allPosts.map(( post ) => post.frontmatter.tags).flat())];
    console.log( allPosts[0].frontmatter.tags );
    
    return uniqueTags.map(( tag ) => ({
        params: {tag: tag},
        props: {posts: allPosts.filter(( post ) => post.frontmatter.tags?.includes(tag))}
    }))
}) satisfies GetStaticPaths;

const { tag } = Astro.params;
const { posts } = Astro.props;

// const filteredPosts = posts.filter(( post ) => post.frontmatter.tags?.includes(tag));
---

<Layout title={tag}>
    <p>Entradas etiquetadas con <b>{tag}</b></p>
    <ul>
        {posts.map(( post ) => <BlogPost url={post.url} title={post.frontmatter.title}/>)}
    </ul>
</Layout>